name: codebot

services:
  bot:
    build:
      context: .
      args:
        # Auto-detect: skip CLI install when API key is set, install when it's not
        HAS_API_KEY: ${ANTHROPIC_API_KEY:+true}
    restart: unless-stopped
    env_file: .env
    ports:
      - "${LOCK_PORT:-47100}:${LOCK_PORT:-47100}"
    volumes:
      - bot-data:/app/data
      - bot-scratch:/app/scratch
      - bot-workspaces:/app/workspaces
      # Max subscription CLI routing: mount host Claude credentials (read-only)
      - ${USERPROFILE:-${HOME:-/tmp}}/.claude:/root/.claude:ro

volumes:
  bot-data:
  bot-scratch:
  bot-workspaces:
